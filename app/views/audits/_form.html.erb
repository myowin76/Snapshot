
<%= simple_form_for @audit, :html => { :multipart => true } do |f| %>
  <%= f.error_notification %>

  <div class="form-inputs">

    <%#= f.association :retailer,:include_blank => false ,  :prompt => 'Please Select'  %>
    <% unless params[:retailer].present?  %>
      <%= f.association :retailer, :prompt => 'Please Select'  %>
    <% else  %>  
      <%#= f.association :retailer, :selected => params[:retailer] %>

      <% retailer = Retailer.find_by_name(params[:retailer])  %>
      <%= f.input :retailer_id, :as => :hidden, :input_html => {:value => retailer.id} %>
      <%= f.label "Retailer" %>
      <%= retailer.name %>
    <% end  %>
    <%#= f.association :store, :include_blank => false %>
    
    <p>
      <%= f.label "Store" %>
      <% unless params[:store].present?  %>
        <%= f.grouped_collection_select :store_id, Retailer.order(:name), :stores, :name, :id, :name, 
        include_blank: true %>
        <%= link_to "add new store", new_store_path, :class => "add-store" %>
      <% else %>
        <% store = Store.find_by_name(params[:store]) %>
        <%= f.input :store_id, :as => :hidden, :input_html => {:value => store.id} %>
        <%= store.name %>
      <% end %>  
    </p>
      
    <%= f.association :channel, :include_blank => false %>
    <%= f.association :environment_type, :include_blank => false %>
    
    <%= f.fields_for :photos do |photo_fields| %>
      <% if photo_fields.object.new_record? %>
          <%= photo_fields.file_field :photo, :class=>'file-upload' %><br />
          <%#= render :partial => "file_upload", :locals => { photo_fields => :photo } %>  
      <% end %>
    <% end %>
    <script id="template-upload" type="text/x-tmpl">
    <div class="upload">
      {%=o.name%}
      <div class="progress"><div class="bar" style="width: 0%"></div></div>
    </div>
    </script>


    <section style="clear:both;overflow:hidden;">
    <%= f.fields_for :photos do |photo_fields| %>      
      <% unless photo_fields.object.new_record? %>
        
        <div class="thumb" style="border-top: 1px solid #ddd;overflow:hidden;padding: 20px 0;">
          <div class="span2">
            <%#= link_to image_tag(photo_fields.object.photo.url(:small)), photo_fields.object.photo.url(:original) %>
            <%= image_tag(photo_fields.object.photo.url(:medium)) %>
          </div>
          <div class="span6">  
            <label>Headline</label>
            <%= photo_fields.text_field :headline %>
            <label>Date Created</label>
            <%= photo_fields.text_field :created_at, :class=>"created_at"%>
            <%= photo_fields.association :brand, :include_blank => false %>
            <label>Additional Brands</label>
            <%= photo_fields.text_field :additional_brands %>
            <%= photo_fields.association :category, :include_blank => false %>
            
            <%= photo_fields.association :media_location, :include_blank => false %>
            <%= photo_fields.association :media_vehicle, :include_blank => false %>
            <%= photo_fields.association :media_type, :include_blank => false %>
            <%= photo_fields.association :promotion_type, {:include_blank => "None"} %>
            <%= photo_fields.association :promotion_calendar, {:include_blank => "None"} %>
            <%= photo_fields.association :theme, :include_blank => false %>
            <%= photo_fields.input_field :published, :as => :boolean, inline_label: 'Publish' %>   
            <%= photo_fields.input_field :_destroy, :as => :boolean, inline_label: 'Destroy' %>   
            
          </div>
        </div>  
      <% end %>
    <% end %>

    </section>
  </div>

    <div class="form-actions">
      <%= f.button :submit, "Next", :class=>"btn btn-primary" %>
    </div>

<% end %>
