<!DOCTYPE html>
<html>
  <%= render 'layouts/blocks/head' %>
  <body>
    <%= render 'layouts/blocks/auth_header' %>
    <div class="container">
      
      <div id = "main" >
     
        <section class="overlay"></section>
        <section class="site-content" role="main">
          <% flash.each do |name, msg| %>
            <div class="alert alert-<%= name == :notice ? "success" : "error" %>">
              <%= content_tag :div, msg %>
              <p class="pull-right">close</p>
            </div>

          <% end %>
          
          <%#= content_tag :h1, yield(:title) if show_title? %>
          <%= yield %>
        </section>
         
      </div> 
  
      <%= render 'layouts/blocks/footer' %>

    <div id="photo-detail-model" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    </div>      
  </div>  <!-- /.container -->

    <%= yield :scripts %>

    
<form class="form-horizontal" id="email-form">


<div id="notLogginInModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-left:0; width: auto;">

  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">So sorry, but it seems you're not a subscriber
to Snapshot yet!</h3>

  </div>

  <div class="modal-body">


      <p>Don't worry, send us a message and we’ll get back to you.</p>
      <div class="control-group">
        <label class="control-label" for="inputEmail">Email</label>
        <div class="controls">
          
          <input type="text" id="inputEmail" name="inputEmail" placeholder="Email" class="string required">
        
        </div>
      </div>
      <div class="control-group">
        <label class="control-label" for="msg">Message</label>
        <div class="controls">

          <textarea id="msg" name="msg" rows="7" placeholder="Message"></textarea>

        </div>
      </div>
  </div>

  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <input class="btn btn-primary" type="submit" value="Send" id="send">
  </div>
</div>
</form>

<script type="text/javascript">


  jQuery(document).ready(function($) {

    var timeID;

    // Stuff to do as soon as the DOM is ready. Use $() w/o colliding with other libs;
    //console.log($('#user_email').is(":focus"));

    if ($('#user_email').is(":focus") == false && $('#user_password').is(":focus") == false){
      
      timeID = setInterval(function(){
        $('#notLogginInModal').modal('show');
        clearInterval(timeID);
      }, 3000);    

    }

    // Clear Interval if form inputs are focused 
    $('#new_user').on('focus', '#user_email, #user_password', function(){
      clearInterval(timeID);
    });
    
    
  });

  $('#email-form').validate({
      debug: true,
      submitHandler: function(form){
        
        console.log('start');
        var info = {}
        info['email'] = $('#notLogginInModal #inputEmail').val();
        info['message'] = $('#notLogginInModal #msg').val();
        
        $.ajax({
          url: '/pages/loginpage_message',
          type: "POST",
          dataType: 'script',
          data: info,
          success: function(data){
            console.log('success!!!!');
            // to show sent message on popup form
            $('#notLogginInModal .modal-header h3').html("Message Sent");
            $('#notLogginInModal .modal-body').html("We will get back to you as soon as possible");
            $('#notLogginInModal input[type="submit"]').remove();
            
          }
        })
      },

      onsubmit: true,  
      rules: {
        inputEmail: {
          required: true,
          email: true
        },
        msg: {
          required: true,
          minlength: 4
        }
      },
      highlight: function(label){
        $(label).closest('.control-group').addClass('error');
      },
      success: function(label){ 
        label
          .text('OK!').addClass('valid')
          .closest('.control-group').addClass('success');
      }
    });
</script>

  </body>
</html>
