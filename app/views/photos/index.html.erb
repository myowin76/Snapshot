<h1>Listing photos</h1>

<aside>

    <h3>Search by</h3>  

    <%= form_tag root_path :method => 'get' do %>
      <p>
        <%= label_tag "Postcode" %>
        <%= text_field_tag "search[postcode]" %>
      </p>
      <p>
        <%= label_tag "Country" %>
        <%= collection_select(:search, :country_id, Country.find(:all), :id, :name) %>
      </p>
      <p>  
        <h3>Sectors</h3>
        <% for sector in @sectors %>
          <%= check_box_tag "search[sector][]", sector.id %>
          <%= sector.name %><br />
        <% end %>
      </p>
      <p>  
        <h3>Channels</h3>
        <% for channel in @channels %>
          <%= check_box_tag "search[channel][]", channel.id %>
          <%= channel.name %><br />
        <% end %>
      </p>
      <p>
        <h3>Categories</h3>  
        <% for category in @categories %>
          <%= check_box_tag "search[category][]", category.id %>
          <%= category.name %><br />
        <% end %>
      </p>
      <p>
        <h3>Dates</h3>
        <fieldset>
          <%= label_tag "From" %><br />
          <%= text_field_tag "search[fromDate]" %>
        </fieldset>
        <fieldset>
          <%= label_tag "To" %><br />
        <%= text_field_tag "search[toDate]" %>
        </fieldset>
        
      </p>
      <p>  
        <%= submit_tag "Search", :name => nil, :class=> 'btn btn-success' %>
        <a href="#" class='btn'>Clear</a>
      </p>
    <% end %>

</aside>
<div class="main">
    <%= gmaps4rails(@json) %>
    
<h4><%= @stores.count %> Stores found</h4>
<table id="photo-list">
  <thead>

    <tr>
      <th></th>
      <th>Photo</th>
      <th>Date</th>
      <th>Category</th>
      <th>Store</th>
      <th>Details</th>
    </tr>
  </thead>
    
    <tbody>
    <% unless @photos.nil? %>    
      <% @photos.each do |photo| %>
          <tr>
              <td>
                <%= check_box_tag photo.id %>
              </td>
              <td>
                  <%= link_to image_tag(photo.photo.url(:thumb)), photo.photo.url(:originals)  %>
              </td>
              <td>  
                  <%= photo.created_at.strftime('%d/%m/%Y') %>
              </td>
              <td>    
                  <%= photo.category.name %>
              </td>
              <td>
                  <%= photo.audit.store.name %>
              </td>
              <td>
                  <%# unless photo.promotion_calendar_id.nil? %>
                    <!--strong>Promotion Calendar:</strong> <%#= photo.promotion_calendar.name %><br />
                  <% #end %>
                  <% #unless photo.promotion_type_id.nil? %>
                    <strong>Promotion Type:</strong> <%#= photo.promotion_type.name %><br />
                  <% #end %>
                -->
                  
                  <%= link_to "Details", photo %>
              </td>
                  
                  <%#= link_to 'Show', photo %>
                  <%#= link_to 'Edit', edit_photo_path(photo) %>
                  <%#= link_to 'Destroy', photo, method: :delete, data: { confirm: 'Are you sure?' } %>
              
          </tr>
      <% end %>
        
    <% end %>
    </tbody>
</table>
<%#= link_to 'New Photo', new_photo_path %>
</div>